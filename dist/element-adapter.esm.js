const e=(e,t)=>r=>e*r[t],t=e=>()=>e,r=(e,t)=>{const r=typeof e,s=typeof t;if(r===s)return!0;throw new Error(`type mismatch: a(${e}) is ${r} and b(${t}) is ${s}`)};var s={">":e=>(t,s)=>{const n=e(t);return r(s,n)&&s>n},">=":e=>(t,s)=>{const n=e(t);return r(s,n)&&s>=n},"<":e=>(t,s)=>{const n=e(t);return r(s,n)&&s<n},"<=":e=>(t,s)=>{const n=e(t);return r(s,n)&&s<=n},"==":e=>(t,r)=>r===e(t)};const n={width:"w%",height:"h%"},i=Object.entries(n).reduce((e,[t,r])=>({...e,[r]:t}),{}),o=(e,t,r)=>{if(0===t.length)return;const s=document.createElement("b");s.style.position="absolute",e.appendChild(s);const n=t.reduce((e,t)=>({...e,[t]:r(s,t)}),{});return e.removeChild(s),n},a=(e,t)=>o(e,t,(e,t)=>(e.style.width="1"+t,e.getBoundingClientRect().width)),c=(e,t)=>o(e.parentNode,t,(e,t)=>{const r=i[t];e.style[r]="1%";const{[r]:s}=e.getBoundingClientRect();return s}),p=e=>["width","height"].includes(e),u=(e,t)=>e>t?"landscape":e<t?"portrait":"square",d=(e,t)=>e/t,h=["width","height","aspect-ratio","orientation","children","characters"],l=["%","cap","ch","em","ex","ic","lh","rem","rlh","vb","vh","vi","vw","vmin","vmax","mm","Q","cm","in","pt","pc"],m=new RegExp(`^(\\d+(\\.\\d+)?)(${l.join("|")})$`),w=/^\d+(\.\d+)?(px)?$/,g=r=>{const i=r.trim().toLowerCase().split(/\s*,\s*/),o=[],a=[],c=[],p=[];for(const r of i){const i=r.split(/\s*&&\s*/),u=[];for(const r of i){const[i,o,d]=r.split(/\s+/),[,h,,l]=d.match(m)||[],g="%"===l?n[i]:l,f=g&&parseFloat(h);let b;if(p.push(i),g)("%"===l?c:a).push(g),b=e(f,g);else{const e=d.match(w)?parseFloat(d):d;b=t(e)}u.push({[i]:s[o](b)})}o.push(u)}return{query:o,units:a,percentUnits:c,watchedProperties:p}},f=({query:e,unitsMeasurements:t,props:r})=>e.some(e=>e.every(e=>{const[[s,n]]=Object.entries(e);return n(t,r[s])})),b=e=>"INPUT"===e.tagName&&!["button","submit","image"].includes(e.getAttribute("type"))||"TEXTAREA"===e.tagName,v=e=>b(e)?e.value.trim().length:e.isContentEditable?e.textContent.trim().length:0,E=e=>e.isContentEditable,y=e=>e.parentElement.isContentEditable?y(e.parentElement):e,C=({elt:e,props:t,queries:r,unitsMeasurements:s})=>{const n={...t,characters:t.characters||0,children:t.children||0};for(const[t,i]of Object.entries(r))e.classList.toggle(t,f({query:i,unitsMeasurements:s,props:n}));for(const[r,s]of Object.entries(t))e.style.setProperty("--ea-"+r,p(r)?s+"px":s)},O=e=>{const t=["width","height","orientation","aspect-ratio"];return e.some(e=>t.includes(e))},$=e=>e.includes("characters"),q=(e,t)=>$(e)&&t.isContentEditable,j=e=>e.includes("children"),P=(e,t)=>{const r={};if(O(t)){const{clientWidth:t,clientHeight:s}=e,{paddingTop:n,paddingRight:i,paddingBottom:o,paddingLeft:a}=window.getComputedStyle(e),c=t-(parseInt(a,10)+parseInt(i,10)),p=s-(parseInt(n,10)+parseInt(o,10));Object.assign(r,{width:c,height:p,orientation:u(c,p),"aspect-ratio":d(c,p)})}return $(t)&&(e.isContentEditable||b(e))&&(r.characters=v(e)),!j(t)||e.isContentEditable||b(e)||(r.children=e.childElementCount),r},A=(e,t,r=!1)=>{e.observe(t,{childList:!0,characterData:r,subtree:r})},L=`((width|height)\\s+(((>|<)=?)|==)\\s+\\d+(\\.\\d+)?(${l.join("|")}|px)|(characters|children)\\s+(((>|<)=?)|==)\\s+\\d+|aspect-ratio\\s+(((>|<)=?)|==)\\s+\\d+(\\.\\d+)?|orientation\\s+==\\s+(landscape|portrait|square))`,U=`${L}(\\s+&&\\s+${L})*`,x=new RegExp(`^\\s*${U}(\\s*,\\s*${U})*\\s*$`);export default function({target:e,queries:t={},...r}={}){(e=>{for(const t of Object.values(e))if(!t||!t.match(x))throw new Error(`invalid query "${t}"`)})(t),(({watchedProperties:e})=>{if(e&&(!Array.isArray(e)||e.length<1||!e.every(e=>h.includes(e))))throw new Error("watchedProperties must be an array with at least one of "+h.join(", "))})(r);const s=(e=>{if(!e)throw new Error("target must be provided");const t="length"in Object(e)?Array.from(e):[e];if(t.length<1)throw new Error("at least one Element must be provided as target");if(t.some(e=>!(e instanceof window.Element)))throw new Error(`target must be an Element or a list of Elements. Actual:\n[${t.map(e=>String(e)).join(", ")}]`);return t})(e),{compiledQueries:n,units:i,percentUnits:o,watchedProperties:p}=(e=>{const t={},r=[],s=[],n=[];for(const[i,o]of Object.entries(e)){const e=g(o);t[i]=e.query,r.push(...e.units),s.push(...e.percentUnits),n.push(...e.watchedProperties)}return{compiledQueries:t,units:r,percentUnits:s,watchedProperties:n}})(t);var l;return(e=>{const{ResizeObserver:t,MutationObserver:r}=window,s=new WeakMap,n={...e,propsCache:s},{elements:i,compiledQueries:o,units:p,percentUnits:l,watchedProperties:m}=e,w=O(m)&&(({propsCache:e,compiledQueries:t,units:r,percentUnits:s})=>n=>{for(const{contentRect:{width:i,height:o},target:p}of n){const n={...e.get(p),width:i,height:o,orientation:u(i,o),"aspect-ratio":d(i,o)};e.set(p,n),window.requestAnimationFrame(()=>C({elt:p,props:n,queries:t,unitsMeasurements:{...a(p,r),...c(p,s)}}))}})(n),g=w&&new t(w),f=$(m)&&(({propsCache:e,compiledQueries:t,units:r,percentUnits:s})=>({target:n})=>{const i=n.value.trim().length,o=e.get(n);if(i!==o.characters){const i={...o,characters:v(n)};e.set(n,i),C({elt:n,props:i,queries:t,unitsMeasurements:{...a(n,r),...c(n,s)}})}})(n),L=(j(m)||$(m)&&Array.from(i).some(E))&&(({propsCache:e,compiledQueries:t,units:r,percentUnits:s,elements:n,watchedProperties:i})=>(o,p)=>{p.disconnect();for(const{type:n,target:p}of o){const{parentElement:o}=p;if(o&&["childList","characterData"].includes(n)){let n;n=p.nodeType!==window.Node.TEXT_NODE?q(i,p)?y(p):p:y(o);const u={...e.get(n)};!j(i)||n.isContentEditable||b(n)||(u.children=n.childElementCount),q(i,n)&&(u.characters=v(n)),e.set(n,u),C({elt:n,props:u,queries:t,unitsMeasurements:{...a(n,r),...c(n,s)}})}}for(const e of n)A(p,e,q(i,e))})(n),U=L&&new r(L);for(const e of i){const t=P(e,m);s.set(e,t),g&&g.observe(e),f&&b(e)&&e.addEventListener("input",f),U&&A(U,e,q(m,e)),C({elt:e,props:t,queries:o,unitsMeasurements:{...a(e,p),...c(e,l)}})}return()=>(({elements:e,mutationObserver:t,resizeObserver:r,inputListener:s,behaviourCssClasses:n})=>{t&&t.disconnect();for(const t of e)r&&r.unobserve(t),s&&b(t)&&t.removeEventListener("input",s),t.classList.remove(...n),h.map(e=>t.style.removeProperty("--ea-"+e))})({elements:i,mutationObserver:U,resizeObserver:g,inputListener:f,behaviourCssClasses:Object.keys(o)})})({elements:s,compiledQueries:n,units:i,percentUnits:o,watchedProperties:(l=[...p,...r.watchedProperties||[]],l.length>0?Array.from(new Set(l)):l)})}
