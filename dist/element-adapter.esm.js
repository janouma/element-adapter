const e=e=>e.length>0?Array.from(new Set(e)):e,t=(e,t)=>r=>e*r[t],r=e=>()=>e,s=(e,t)=>{const r=typeof e,s=typeof t;if(r===s)return!0;throw new Error(`type mismatch: a(${e}) is ${r} and b(${t}) is ${s}`)};var n={">":e=>(t,r)=>{const n=e(t);return s(r,n)&&r>n},">=":e=>(t,r)=>{const n=e(t);return s(r,n)&&r>=n},"<":e=>(t,r)=>{const n=e(t);return s(r,n)&&r<n},"<=":e=>(t,r)=>{const n=e(t);return s(r,n)&&r<=n},"==":e=>(t,r)=>{const n=e(t);return s(r,n)&&r===e(t)}};const i={width:"w%",height:"h%"},o=Object.entries(i).reduce((e,[t,r])=>({...e,[r]:t}),{}),a=(e,t,r)=>{if(0===t.length)return;const s=document.createElement("b");s.style.position="absolute",e.appendChild(s);const n=t.reduce((e,t)=>({...e,[t]:r(s,t)}),{});return e.removeChild(s),n},c=(e,t)=>a(e,t,(e,t)=>(e.style.width="1"+t,e.getBoundingClientRect().width)),p=(e,t)=>a(e.parentNode,t,(e,t)=>{const r=o[t];e.style[r]="1%";const{[r]:s}=e.getBoundingClientRect();return s}),u=e=>["width","height"].includes(e),h=(e,t)=>e>t?"landscape":e<t?"portrait":"square",d=(e,t)=>e/t,l=["width","height","aspect-ratio","orientation","children","characters"],m=["%","cap","ch","em","ex","ic","lh","rem","rlh","vb","vh","vi","vw","vmin","vmax","mm","Q","cm","in","pt","pc"],w=new RegExp(`^(\\d+(\\.\\d+)?)(${m.join("|")})$`),g=/^\d+(\.\d+)?(px)?$/,f=e=>{const s=e.trim().toLowerCase().split(/\s*,\s*/),o=[],a=[],c=[],p=[];for(const e of s){const s=e.split(/\s*&&\s*/),u=[];for(const e of s){const[s,o,h]=e.split(/\s+/),[,d,,l]=h.match(w)||[],m="%"===l?i[s]:l,f=m&&parseFloat(d);let b;if(p.push(s),m)("%"===l?c:a).push(m),b=t(f,m);else{const e=h.match(g)?parseFloat(h):h;b=r(e)}u.push({[s]:n[o](b)})}o.push(u)}return{query:o,units:a,percentUnits:c,watchedProperties:p}},b=({query:e,unitsMeasurements:t,props:r})=>e.some(e=>e.every(e=>{const[[s,n]]=Object.entries(e);return n(t,r[s])})),v=e=>"INPUT"===e.tagName&&!["button","submit","image"].includes(e.getAttribute("type"))||"TEXTAREA"===e.tagName,E=e=>v(e)?e.value.trim().length:e.isContentEditable?e.textContent.trim().length:0,y=e=>e.isContentEditable,C=e=>e.parentElement.isContentEditable?C(e.parentElement):e,O=({elt:e,props:t,queries:r,unitsMeasurements:s})=>{const n={...t,characters:t.characters||0,children:t.children||0};for(const[t,i]of Object.entries(r))e.classList.toggle(t,b({query:i,unitsMeasurements:s,props:n}));for(const[r,s]of Object.entries(t))e.style.setProperty("--ea-"+r,u(r)?s+"px":s)},q=e=>{const t=["width","height","orientation","aspect-ratio"];return e.some(e=>t.includes(e))},P=e=>e.includes("characters"),$=(e,t)=>P(e)&&t.isContentEditable,j=e=>e.includes("children"),A=(e,t)=>{const r={};if(q(t)){const{clientWidth:t,clientHeight:s}=e,{paddingTop:n,paddingRight:i,paddingBottom:o,paddingLeft:a}=window.getComputedStyle(e),c=t-(parseInt(a,10)+parseInt(i,10)),p=s-(parseInt(n,10)+parseInt(o,10));Object.assign(r,{width:c,height:p,orientation:h(c,p),"aspect-ratio":d(c,p)})}return P(t)&&(e.isContentEditable||v(e))&&(r.characters=E(e)),!j(t)||e.isContentEditable||v(e)||(r.children=e.childElementCount),r},L=(e,t,r=!1)=>{e.observe(t,{childList:!0,characterData:r,subtree:r})},U=`((width|height)\\s+(((>|<)=?)|==)\\s+\\d+(\\.\\d+)?(${m.join("|")}|px)|(characters|children)\\s+(((>|<)=?)|==)\\s+\\d+|aspect-ratio\\s+(((>|<)=?)|==)\\s+\\d+(\\.\\d+)?|orientation\\s+==\\s+(landscape|portrait|square))`,x=`${U}(\\s+&&\\s+${U})*`,M=new RegExp(`^\\s*${x}(\\s*,\\s*${x})*\\s*$`);export default function({target:t,queries:r={},...s}={}){(e=>{for(const t of Object.values(e))if(!t||!t.match(M))throw new Error(`invalid query "${t}"`)})(r),(({watchedProperties:e})=>{if(e){if(!Array.isArray(e))throw new Error("watchedProperties must be an array");if(e.length<1||!e.every(e=>l.includes(e)))throw new Error("watchedProperties must be an array with at least one of "+l.join(", "))}})(s);const n=(e=>{if(!e)throw new Error("target must be provided");const t="length"in Object(e)?Array.isArray(e)?e:Array.from(e):[e];if(t.length<1)throw new Error("at least one Element must be provided as target");if(t.some(e=>!(e instanceof window.Element)))throw new Error(`target must be an Element or a list of Elements. Actual:\n[${t.map(e=>String(e)).join(", ")}]`);return t})(t),{compiledQueries:i,units:o,percentUnits:a,watchedProperties:u}=(t=>{const r={},s=[],n=[],i=[];for(const[e,o]of Object.entries(t)){const t=f(o);r[e]=t.query,s.push(...t.units),n.push(...t.percentUnits),i.push(...t.watchedProperties)}return{compiledQueries:r,units:e(s),percentUnits:e(n),watchedProperties:e(i)}})(r);if(u.length<1&&!s.watchedProperties)throw new Error("at least one query or one watched properties must be provided");return(e=>{const{ResizeObserver:t,MutationObserver:r}=window,s=new WeakMap,n={...e,propsCache:s},{elements:i,compiledQueries:o,units:a,percentUnits:u,watchedProperties:m}=e,w=q(m)&&(({propsCache:e,compiledQueries:t,units:r,percentUnits:s})=>n=>{for(const{contentRect:{width:i,height:o},target:a}of n){const n={...e.get(a),width:i,height:o,orientation:h(i,o),"aspect-ratio":d(i,o)};e.set(a,n),window.requestAnimationFrame(()=>O({elt:a,props:n,queries:t,unitsMeasurements:{...c(a,r),...p(a,s)}}))}})(n),g=w&&new t(w),f=P(m)&&(({propsCache:e,compiledQueries:t,units:r,percentUnits:s})=>({target:n})=>{const i=n.value.trim().length,o=e.get(n);if(i!==o.characters){const i={...o,characters:E(n)};e.set(n,i),O({elt:n,props:i,queries:t,unitsMeasurements:{...c(n,r),...p(n,s)}})}})(n),b=(j(m)||P(m)&&Array.from(i).some(y))&&(({propsCache:e,compiledQueries:t,units:r,percentUnits:s,elements:n,watchedProperties:i})=>(o,a)=>{a.disconnect();for(const{type:n,target:a}of o){const{parentElement:o}=a;if(o&&["childList","characterData"].includes(n)){let n;n=a.nodeType!==window.Node.TEXT_NODE?$(i,a)?C(a):a:C(o);const u={...e.get(n)};!j(i)||n.isContentEditable||v(n)||(u.children=n.childElementCount),$(i,n)&&(u.characters=E(n)),e.set(n,u),O({elt:n,props:u,queries:t,unitsMeasurements:{...c(n,r),...p(n,s)}})}}for(const e of n)L(a,e,$(i,e))})(n),U=b&&new r(b);for(const e of i){const t=A(e,m);s.set(e,t),g&&g.observe(e),f&&v(e)&&e.addEventListener("input",f),U&&L(U,e,$(m,e)),O({elt:e,props:t,queries:o,unitsMeasurements:{...c(e,a),...p(e,u)}})}return()=>(({elements:e,mutationObserver:t,resizeObserver:r,inputListener:s,behaviourCssClasses:n})=>{t&&t.disconnect();for(const t of e)r&&r.unobserve(t),s&&v(t)&&t.removeEventListener("input",s),t.classList.remove(...n),l.map(e=>t.style.removeProperty("--ea-"+e))})({elements:i,mutationObserver:U,resizeObserver:g,inputListener:f,behaviourCssClasses:Object.keys(o)})})({elements:n,compiledQueries:i,units:o,percentUnits:a,watchedProperties:e([...u,...s.watchedProperties||[]])})}
